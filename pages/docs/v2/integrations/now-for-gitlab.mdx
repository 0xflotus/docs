import Doc from '~/components/layout/docs'
import Now from '~/components/text/now'
import { Image } from '~/components/media'
import Caption from '~/components/text/caption'
import { TerminalInput } from '~/components/text/terminal'
import { InlineCode } from '~/components/text/code'
import Note from '~/components/text/note'
import { GenericLink } from '~/components/text/link'

export const meta = {
  title: 'Now for GitLab',
  description:
    'Deploy each change in your GitLab repositories with Now to share and test with your colleagues. Instant share-able links to your work with each push. Automatically alias your changes to production.'
}

Now for GitLab is an app that automatically deploys and aliases your GitLab projects with Now.

Now for GitLab integration features:

- Deploys every git push in branches and merge requests to preview changes live
- Aliases the most recent changes from the default branch (usually master)
- Instant rollbacks when reverting changes that have been aliased

<Image
src={`${process.env.ASSETS}/docs/now-for-gitlab/ci.png`}
width={2304/2}
height={1702/2}
/>
<Caption>Now for GitLab providing a deployment for a GitLab pull request.</Caption>

## Connecting the App to Your GitLab Account

You can simply connect the Now for GitLab app by visiting your account or team settings page and clicking the "Connect with GitLab" button.

<Image
src={`${process.env.ASSETS}/docs/now-for-gitlab/connect-with-gitlab.png`}
width={1440/2}
height={384/2}
/>
<Caption>The Now for GitLab installation section within the account or team general settings page.</Caption>

Next, you need to authorize the application on GitLab.

<Image
src={`${process.env.ASSETS}/docs/now-for-gitlab/authorize-gitlab.png`}
width={2192/2}
height={1584/2}
/>
<Caption>The Now for GitLab Authorization section within the account or team onboarding.</Caption>

It'll redirect back to the ZEIT account or team settings page.

## Link GitLab Projects

Now only deploys for GitLab projects you explicitly linked from the following UI in the account or team settings page.

You can link projects across all the GitLab namespaces you have access to.

You can unlink a project at anytime.

<Image
  src={`${process.env.ASSETS}/docs/now-for-gitlab/link-gitlab.png`}
  width={1456/2}
  height={582/2}
/>
<Caption>Link GitLab Projects.</Caption>

## Sign Up / Login with GitLab

Once you connected, you can login with GitLab from our login page.

<Image
  src={`${process.env.ASSETS}/docs/now-for-gitlab/login-with-gitlab.png`}
  width={1994/2}
  height={1488/2}
/>
<Caption>Login to ZEIT with GitLab.</Caption>

## Usage

Once you link a GitLab project, we'll deploy for every git-push related to that project. If there's no `now.json` file we'll deploy that project as a static app.

However, you can always configure the `now.json` file to customize your app with different runtimes thanks to our v2 platform.

## A Deployment for each Push

Now for GitLab will **deploy every push by default**. This includes pushes to any branch and any pull requests made from those branches. This allows those working within the repository to preview changes made before they are pushed to production.

With each new push, if Now is already building a previous commit, it will cancel that current build to start the most recent commit, ensuring you always have the latest changes deployed as quickly as possible.

## Aliasing the Default Branch

If [an alias is set within the `now.json` file](https://zeit.co/docs/features/aliases/), pushes and merges to the [default branch](https://help.github.com/articles/setting-the-default-branch/) (commonly "master") will be aliased automatically and made live to those aliases with the latest deployment made with a push.

For example, the following `now.json` configuration will make Now for GitLab alias the most recent push to `my-zeit-website.com` by default.

```json
{
  "alias": ["my-zeit-website.com"]
}
```

## Included Environment Variables

You may want to use different workflows and APIs based on Git information. In order to support that, Now will deploy your app with the following built-in environment variables.

```json
{
  "GITLAB_DEPLOYMENT": "1",
  "GITLAB_PROJECT_NAMESPACE": "arunoda",
  "GITLAB_PROJECT_NAME": "Hello World",
  "GITLAB_PROJECT_ID": "10996376",
  "GITLAB_PROJECT_PATH": "arunoda/hello-world",
  "GITLAB_COMMIT_REF": "update-marketing-content",
  "GITLAB_COMMIT_SHA": "36b889abc87fe0f205e65704d2217943bd28afdf",
  "GITLAB_COMMIT_MESSAGE": "Make sure to add the year we did this.",
  "GITLAB_COMMIT_AUTHOR_LOGIN": "arunoda",
  "GITLAB_COMMIT_AUTHOR_NAME": "Arunoda Susiripala"
}
```

<Note>
  You can access these as 
  <GenericLink href="https://zeit.co/docs/v2/deployments/configuration/#build-env">
    build environment variables
  </GenericLink>
   also.
</Note>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
